<!DOCTYPE html>
<html lang="en">


<!-- molla/product.html  22 Nov 2019 09:54:50 GMT -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FurnIt</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icons/furnit-logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icons/furnit-logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icons/furnit-logo.png">
    <link rel="manifest" href="/assets/images/icons/site.html">
    <link rel="mask-icon" href="/assets/images/icons/furnit-logo.png" color="#666666">
    <link rel="shortcut icon" href="/assets/images/icons/furnit-logo.png">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="/assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/plugins/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="/assets/css/plugins/magnific-popup/magnific-popup.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/plugins/nouislider/nouislider.css">
    
</head>

<body>
    <%-include('../layouts/navbar.ejs')%>
    <!-- <div class="page-wrapper"> -->
        <main class="main">
            <div class="page-content">
                <div class="container">
                    <div class="product-details-top">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="product-gallery product-gallery-vertical">
                                    <div class="row">
                                        <figure class="product-main-image">
                                            <img id="product-zoom" src="/uploads/<%= product.image[3]%>" data-zoom-image="/uploads/<%= product.image[3]%>" alt="product image">

                                            <a href="#" id="btn-product-gallery" class="btn-product-gallery">
                                                <i class="icon-arrows"></i>
                                            </a>
                                        </figure><!-- End .product-main-image -->

                                        <div id="product-zoom-gallery" class="product-image-gallery">
                                            <a class="product-gallery-item active" href="#" data-image="/uploads/<%= product.image[3]%>" data-zoom-image="/uploads/<%= product.image[3]%>">
                                                <img src="/uploads/<%= product.image[3]%>" alt="product side">
                                            </a>

                                            <a class="product-gallery-item" href="#" data-image="/uploads/<%= product.image[0]%>" data-zoom-image="/uploads/<%= product.image[0]%>">
                                                <img src="/uploads/<%= product.image[0]%>" alt="product cross">
                                            </a>

                                            <a class="product-gallery-item" href="#" data-image="/uploads/<%= product.image[1]%>" data-zoom-image="/uploads/<%= product.image[1]%>">
                                                <img src="/uploads/<%= product.image[1]%>" alt="product with model">
                                            </a>

                                            <a class="product-gallery-item" href="#" data-image="/uploads/<%= product.image[2]%>" data-zoom-image="/uploads/<%= product.image[2]%>">
                                                <img src="/uploads/<%= product.image[2]%>" alt="product back">
                                            </a>
                                        </div><!-- End .product-image-gallery -->
                                    </div><!-- End .row -->
                                </div><!-- End .product-gallery -->
                            </div><!-- End .col-md-6 -->

                            <div class="col-md-6">
                                <div class="product-details">
                                    <h1 class="product-title"><%=product.name%></h1><!-- End .product-title -->

                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                        <a class="ratings-text" href="#product-review-link" id="review-link">( 2 Reviews )</a>
                                    </div><!-- End .rating-container -->

                                    <div class="product-price">
                                        ₹<%=product.price%>
                                    </div><!-- End .product-price -->
                                    <div class="stock-col">
                                        <% if (product.quantity !== undefined) { %>
                                            <% const quantity = product.quantity; %>
                                            <% if (quantity === 0) { %>
                                                <strong><span class="out-of-stock" style="color: red;">Out of stock</span></strong>
                                            <% } else if (quantity > 0 && quantity <= 10) { %>
                                                <strong><span class="low-stock" style="color: orange;">Low stock</span></strong>
                                            <% } else { %>
                                                <strong><span class="in-stock" style="color: rgb(88, 198, 88);">In stock</span></strong>
                                            <% } %>
                                        <% } else { %>
                                            <strong><span class="unknown-status">Unknown</span></strong>
                                        <% } %>
                                    </div>

                                    <div class="product-content">
                                        <p><%=product.description%></p>
                                    </div><!-- End .product-content -->

                                    <div class="details-filter-row details-row-size">
                                        <label for="qty">Qty:</label>
                                        <div class="product-details-quantity">
                                            <input type="number" id="qty" class="form-control" value="1" min="1" max="10" step="1" data-decimals="0" required>
                                        </div><!-- End .product-details-quantity -->
                                    </div><!-- End .details-filter-row -->

                                    <div class="product-details-action">
                                        <a href="#" id="addToCartBtn" class="btn-product btn-cart" <% if (product.quantity === 0) { %>disabled style="pointer-events: none; opacity: 0.5;"<% } %>>
                                            <span>Add to Cart</span>
                                        </a>
                                        
                                        <a href="/cart" id="viewCartBtn" class="btn-product btn-cart" style="display: none; text-align: center;" >
                                            <span>View Cart</span>
                                        </a>
                                        <!-- <a href="#" id="addToCartBtn" class="btn-product btn-cart">
                                            <span>Add to Cart</span>
                                        </a>
            
                                        <a href="/cart" id="viewCartBtn" class="btn-product btn-cart" style="display: none; text-align: center;" >
                                            <span>View Cart</span>
                                        </a> -->
                                        <div class="details-action-wrapper">
                                            <a href="#" class="btn-product btn-wishlist" title="Wishlist" id="addToWishlistBtn">
                                                <span>Add to Wishlist</span>
                                            </a>
                                        </div><!-- End .details-action-wrapper -->
                                    </div><!-- End .product-details-action -->
                                    <div id="loginMessage"></div>
                                </div><!-- End .product-details -->
                            </div><!-- End .col-md-6 -->
                        </div><!-- End .row -->
                    </div><!-- End .product-details-top -->

                    <div class="product-details-tab">
                        <ul class="nav nav-pills justify-content-center" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="product-desc-link" data-toggle="tab" href="#product-desc-tab" role="tab" aria-controls="product-desc-tab" aria-selected="true">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="product-info-link" data-toggle="tab" href="#product-info-tab" role="tab" aria-controls="product-info-tab" aria-selected="false">Additional information</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="product-shipping-link" data-toggle="tab" href="#product-shipping-tab" role="tab" aria-controls="product-shipping-tab" aria-selected="false">Shipping & Returns</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="product-review-link" data-toggle="tab" href="#product-review-tab" role="tab" aria-controls="product-review-tab" aria-selected="false">Reviews (2)</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="product-desc-tab" role="tabpanel" aria-labelledby="product-desc-link">
                                <div class="product-desc-content">
                                    <h3>Product Information</h3>

                                    <p><%=product.description%></p>
                                </div><!-- End .product-desc-content -->
                            </div><!-- .End .tab-pane -->
                            <div class="tab-pane fade" id="product-info-tab" role="tabpanel" aria-labelledby="product-info-link">
                                <div class="product-desc-content">
                                    <h3>Information</h3>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. Suspendisse urna viverra non, semper suscipit, posuere a, pede. Donec nec justo eget felis facilisis fermentum. Aliquam porttitor mauris sit amet orci. </p>

                                    <h3>Fabric & care</h3>
                                    <ul>
                                        <li>Faux suede fabric</li>
                                        <li>Gold tone metal hoop handles.</li>
                                        <li>RI branding</li>
                                        <li>Snake print trim interior </li>
                                        <li>Adjustable cross body strap</li>
                                        <li> Height: 31cm; Width: 32cm; Depth: 12cm; Handle Drop: 61cm</li>
                                    </ul>

                                    <h3>Size</h3>
                                    <p>one size</p>
                                </div><!-- End .product-desc-content -->
                            </div><!-- .End .tab-pane -->
                            <div class="tab-pane fade" id="product-shipping-tab" role="tabpanel" aria-labelledby="product-shipping-link">
                                <div class="product-desc-content">
                                    <h3>Delivery & returns</h3>
                                    <p>We deliver to over 100 countries around the world. For full details of the delivery options we offer, please view our <a href="#">Delivery information</a><br>
                                    We hope you’ll love every purchase, but if you ever need to return an item you can do so within a month of receipt. For full details of how to make a return, please view our <a href="#">Returns information</a></p>
                                </div><!-- End .product-desc-content -->
                            </div><!-- .End .tab-pane -->
                            <div class="tab-pane fade" id="product-review-tab" role="tabpanel" aria-labelledby="product-review-link">
                                <div class="reviews">
                                    <h3>Reviews (2)</h3>
                                    <div class="review">
                                        <div class="row no-gutters">
                                            <div class="col-auto">
                                                <h4><a href="#">Samanta J.</a></h4>
                                                <div class="ratings-container">
                                                    <div class="ratings">
                                                        <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                                                    </div><!-- End .ratings -->
                                                </div><!-- End .rating-container -->
                                                <span class="review-date">6 days ago</span>
                                            </div><!-- End .col -->
                                            <div class="col">
                                                <h4>Good, perfect size</h4>

                                                <div class="review-content">
                                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus cum dolores assumenda asperiores facilis porro reprehenderit animi culpa atque blanditiis commodi perspiciatis doloremque, possimus, explicabo, autem fugit beatae quae voluptas!</p>
                                                </div><!-- End .review-content -->

                                                <div class="review-action">
                                                    <a href="#"><i class="icon-thumbs-up"></i>Helpful (2)</a>
                                                    <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                                </div><!-- End .review-action -->
                                            </div><!-- End .col-auto -->
                                        </div><!-- End .row -->
                                    </div><!-- End .review -->

                                    <div class="review">
                                        <div class="row no-gutters">
                                            <div class="col-auto">
                                                <h4><a href="#">John Doe</a></h4>
                                                <div class="ratings-container">
                                                    <div class="ratings">
                                                        <div class="ratings-val" style="width: 100%;"></div><!-- End .ratings-val -->
                                                    </div><!-- End .ratings -->
                                                </div><!-- End .rating-container -->
                                                <span class="review-date">5 days ago</span>
                                            </div><!-- End .col -->
                                            <div class="col">
                                                <h4>Very good</h4>

                                                <div class="review-content">
                                                    <p>Sed, molestias, tempore? Ex dolor esse iure hic veniam laborum blanditiis laudantium iste amet. Cum non voluptate eos enim, ab cumque nam, modi, quas iure illum repellendus, blanditiis perspiciatis beatae!</p>
                                                </div><!-- End .review-content -->

                                                <div class="review-action">
                                                    <a href="#"><i class="icon-thumbs-up"></i>Helpful (0)</a>
                                                    <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                                </div><!-- End .review-action -->
                                            </div><!-- End .col-auto -->
                                        </div><!-- End .row -->
                                    </div><!-- End .review -->
                                </div><!-- End .reviews -->
                            </div><!-- .End .tab-pane -->
                        </div><!-- End .tab-content -->
                    </div><!-- End .product-details-tab -->
                </div><!-- End .container -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

        <%-include('../layouts/footbar.ejs')%>
    <!-- <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button> -->



    <!-- Login Warning Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Login Required</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
            You need to log in to perform this action.
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <a href="/login" class="btn btn-primary">Login</a> <!-- Link to your login page -->
            </div>
        </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
    const productId = '<%= product._id %>';
    const userId = '<%= userId %>';

    const addToCartBtn = document.getElementById('addToCartBtn');
    const viewCartBtn = document.getElementById('viewCartBtn');
    const addToCartText = document.getElementById('addToCartText'); // Add this line to get the span element

    // Function to add product to cart
    const addToCart = async () => {
        const Quantity = document.getElementById('qty').value;
        const data = {
            productId: productId,
            userId: userId,
            quantity: Quantity
        };

        try {
            const response = await fetch('/addtocart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error('Failed to add product to cart');
            }

            const responseData = await response.json();
            // After adding to cart, update the button text
            if (responseData.isProductInCart) {
                addToCartBtn.style.display = 'none';
                viewCartBtn.style.display = 'inline-block';
            } else {
                addToCartBtn.style.display = 'none';  // Assuming you want to hide the "Add to Cart" button after adding
                viewCartBtn.style.display = 'inline-block';
            }
            
        } catch (error) {
            console.error('Error adding to cart:', error);
        }
    };

    // Add event listener for the "Add to Cart" button
    addToCartBtn.addEventListener('click', () => {
        // Check if the session is available
        const isLoggedIn = '<%= userId !== "" %>';
        if (isLoggedIn) {
            // If user is logged in, proceed with adding to cart
            addToCart();
        } else {
            // If user is not logged in, show the login modal
            $('#loginModal').modal('show');
        }
    });

    // Initial check on page load
    checkCartStatus();  // Call the checkCartStatus function to set the initial button display
});

// Function to check cart status and update button display
const checkCartStatus = async () => {
    try {
        const productId = '<%= product._id %>';  // Declare productId within the function scope
        const userId = '<%= userId %>';
        const response = await fetch('/checkcart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId, userId })
        });

        if (!response.ok) {
            throw new Error('Failed to check cart status');
        }

        const data = await response.json();

        if (data.isProductInCart) {
            console.log('Product is in the cart');
            addToCartBtn.style.display = 'none';
            viewCartBtn.style.display = 'inline-block';
        } else {
            console.log('Product is NOT in the cart');
            addToCartBtn.style.display = 'inline-block';
            viewCartBtn.style.display = 'none';
        }
    } catch (error) {
        console.error('Error checking cart status:', error);
    }
};
</script>

<!-- Add to wishlist -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const addToWishlistBtn = document.getElementById('addToWishlistBtn');

        addToWishlistBtn.addEventListener('click', async () => {
            try {
                const productId = '<%= product._id %>';
                const userId = '<%= userId %>';
                const response = await fetch('/addtowishlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ productId, userId })
                });

                if (!response.ok) {
                    throw new Error('Failed to add product to wishlist');
                }

                const responseData = await response.json();
                // console.log(responseData.message);
            } catch (error) {
                console.error('Error adding to wishlist:', error);
            }
        });
    });
</script>

    <!-- Plugins JS File -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/jquery.hoverIntent.min.js"></script>
    <script src="/assets/js/jquery.waypoints.min.js"></script>
    <script src="/assets/js/superfish.min.js"></script>
    <script src="/assets/js/owl.carousel.min.js"></script>
    <script src="/assets/js/bootstrap-input-spinner.js"></script>
    <script src="/assets/js/jquery.elevateZoom.min.js"></script>
    <script src="/assets/js/bootstrap-input-spinner.js"></script>
    <script src="/assets/js/jquery.magnific-popup.min.js"></script>
    <!-- Main JS File -->
    <script src="/assets/js/main.js"></script>
</body>



<!-- molla/product.html  22 Nov 2019 09:55:05 GMT -->
</html>